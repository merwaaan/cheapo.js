<!doctype html>
<head>
  <title>Cheapo â€” A Javascript CHIP-8 emulator</title>
  <meta charset="utf-8">

  <script src="src/cpu.js"></script>
  <script src="src/video.js"></script>
  <script src="src/audio.js"></script>
  <script src="src/input.js"></script>
  <script src="src/main.js"></script>

  <script src="libs/dat.gui.min.js"></script>

  <link rel="stylesheet" type="text/css" href="screen.css"/>
</head>
<body>

  <header>
    <h1>Cheapo</h1><br/>
    <h2>A Javascript CHIP-8 emulator</h2>
  </header>

  <canvas width="384" height="192"></canvas>

  <input type="file" id="local_rom" style="visibility:hidden"/>

  <footer>
    <ul>
      <li>Source code <a href="https://github.com/merwaaan/cheapo.js">here</a></li>
      <li>ROMs from <a href="http://www.pong-story.com/chip8/">David Winter's emulator</a></li>
      <li><a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM">Cowgod's <i>Technical Reference<i></a> and <a href="">Matthew Mikolay's <i>Mastering CHIP-8<i></a> were nice resources</li>
    </ul></ul>
  </footer>

  <script>

    // Go Cheapo, go!

    window.addEventListener('load', function() {

      Cheapo.Main.init();

      // GUI

      var gui = new dat.GUI();

      var game = gui.addFolder('Game');

      // Select one of the hosted ROMS...

      var hosted = game.add({load:''}, 'load', ['bmp.ch8', 'clock.ch8', 'div.ch8', 'fish.ch8', 'jump.ch8', 'key.ch8', 'keypad.ch8', 'life.ch8', 'logo1.ch8', 'logo2.ch8', 'min.ch8', 'mk1.ch8', 'mk2.ch8', 'pic.ch8', 'rnd.ch8', 'sqrt.ch8', 'timer.ch8', 'SCTEST', '15PUZZLE', 'BLINKY', 'BLITZ', 'BRIX', 'CONNECT4', 'EMUTEST', 'GUESS', 'HIDDEN', 'INVADERS', 'KALEID', 'MAZE', 'MERLIN', 'MISSILE', 'PONG', 'PONG2', 'PUZZLE', 'SYZYGY', 'TANK', 'TETRIS', 'TICTAC', 'UFO', 'VBRIX', 'VERS', 'WIPEOFF']).name('Select');

      hosted.onChange(function(name) {

        var request = new XMLHttpRequest(name);
        request.open('GET', 'roms/' + name, true);
        request.responseType = 'arraybuffer';

        request.onload = function() {
          Cheapo.Main.load(request.response);
        };

        request.send(null);
      });

      // ... Or load a local file

      var file_select = document.querySelector('input#local_rom');

      game.add({
        load: function() {
          file_select.click();
        }
      }, 'load').name('Load a file');


      file_select.addEventListener('change', function() {

        var reader = new FileReader();
        reader.addEventListener('load', function() {
          Cheapo.Main.load(this.result);
        });

        reader.readAsArrayBuffer(this.files[0]);
      });

      game.open();

      var cpu = gui.addFolder('CPU');
      cpu.add(Cheapo.CPU, 'frequency').min(0).max(1000);
      cpu.open();

      var video = gui.addFolder('Video')
      video.add(Cheapo.Video, 'scale').min(1).max(10).step(1);
      video.addColor(Cheapo.Video, 'color');
      video.addColor(Cheapo.Video, 'background');
      video.add(Cheapo.Video, 'wrap');
      video.open();

      var audio = gui.addFolder('Audio');
      audio.add(Cheapo.Audio, 'volume').min(0).max(100).step(1);
      audio.add(Cheapo.Audio, 'frequency').min(0).max(1000).step(1);
      audio.open();
    });

  </script>

</body>
</html>